/*
 * jQuery UI AriaLightbox (05.09.11)
 * http://github.com/fnagel/jQuery-Accessible-RIA
 *
 * Copyright (c) 2009 Felix Nagel for Namics (Deustchland) GmbH
 * Copyright (c) 2010-2011 Felix Nagel
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 *
 * Depends: jQuery UI
 * Optional: jQuery Address Plugin
 */
(function($){$.widget("ui.ariaLightbox",{version:"1.8",options:{altText:function(){return $(this).find("img").attr("alt");},descText:function(){return $(this).find("img").attr("title");},titleText:function(){return"Fullscreen";},prevText:"previous picture",nextText:"next picture",pictureText:"Picture",ofText:"of",closeText:"Close [ESC]",pos:"auto",autoHeight:50,offsetX:10,offsetY:10,disableWidth:550,disableHeight:550,useDimmer:true,animationSpeed:"slow",zIndex:1000,makeHover:true,em:0.0568182,activeImage:0,jqAddress:{enable:true,title:{enable:true,split:" | "}}},_create:function(){var options=this.options,self=this;if(options.imageArray){options.selector=options.imageArray;options.imageArray=self.element.find(options.imageArray);if(options.makeHover){options.imageArray.each(function(){self._makeHover($(this));});}}else{if(options.makeHover){self._makeHover(self.element);}}if($.address&&options.jqAddress.enable){$.address.externalChange(function(event){if(event.value==""&&options.wrapperElement){self.close();}else{if(options.imageArray){for(var x=0;x<options.imageArray.length;x++){if($(options.imageArray[x]).attr("href")==event.value){options.activeImage=x;self._open($(options.imageArray[x]));self._setButtonState();return;}}}else{if(self.element.attr("href")==event.value){self._open(self.element);}}}});}self.element.click(function(event){if(!options.imageArray){return self._open($(this),event);}else{target=$(event.target).closest(options.selector,self.element);if(target.length){options.activeImage=options.imageArray.index(target);return self._open(target,event);}}});if(options.useDimmer){$(window).resize(function(){if(!options.disabled){self._dimmerResize();}});}},startGallery:function(event,index){index=(index)?index:0;this.options.activeImage=index;return this._open($(this.options.imageArray[index]),event);},_open:function(element,event){var options=this.options,self=this;if(!options.disabled&&$(window).width()-options.disableWidth>0&&$(window).height()-options.disableHeight>0){if(!options.imageArray&&event){options.clickedElement=event.currentTarget;}else{options.clickedElement=element;}options.wrapperElement=$("body>div#ui-lightbox-wrapper");if(!options.wrapperElement.length){self._show(element,event);}else{self._changePicture(element,event);}return false;}return true;},_show:function(element,event){var options=this.options,self=this;var html="\n";html+='<div id="ui-lightbox-wrapper" class="ui-dialog ui-widget ui-widget-content ui-corner-all" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-dialog">'+"\n";html+='	<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+"\n";html+='		<span id="ui-dialog-title-dialog" class="ui-dialog-title">'+options.titleText.call(element)+"</span>"+"\n";html+='		<a href="#nogo" id="ui-lightbox-close" class="ui-dialog-titlebar-close ui-corner-all" title="'+options.closeText+'" role="button">'+"\n";html+='			<span class="ui-icon ui-icon-closethick">'+options.closeText+"</span>"+"\n";html+="		</a>"+"\n";html+="	</div>"+"\n";html+='	<div id="ui-lightbox-content">'+"\n";html+='		<div id="ui-lightbox-image"><img src="" aria-describedby="ui-lightbox-description" /></div>'+"\n";html+='		<p id="ui-lightbox-description"></p>'+"\n";if(options.imageArray){html+='		<p id="ui-lightbox-pager"></p>'+"\n";html+='		<div id="ui-dialog-buttonpane" class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">'+"\n";html+='			<div class="ui-dialog-buttonset">'+"\n";html+='				<button id="ui-lightbox-prev" type="button" role="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+options.prevText+"</span></button>"+"\n";html+='				<button id="ui-lightbox-next" type="button" role="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+options.nextText+"</span></button>"+"\n";html+="			</div>"+"\n";html+="		</div>"+"\n";}html+="	</div>	"+"\n";html+="</div>"+"\n";if(options.useDimmer){self._createDimmer();}$("body").append(html);self._trigger("onShow",0);options.wrapperElement=$("body>div#ui-lightbox-wrapper");if(options.imageArray){options.wrapperElement.keydown(function(event){if(event.keyCode==$.ui.keyCode.RIGHT){self.next();}if(event.keyCode==$.ui.keyCode.DOWN){self.next();}if(event.keyCode==$.ui.keyCode.UP){self.prev();}if(event.keyCode==$.ui.keyCode.LEFT){self.prev();}if(event.keyCode==$.ui.keyCode.SPACE){self.next();}if(event.keyCode==$.ui.keyCode.END){options.activeImage=options.imageArray.length-2;event.preventDefault();self.next();}if(event.keyCode==$.ui.keyCode.HOME){options.activeImage=1;event.preventDefault();self.prev();}});options.buttonpane=options.wrapperElement.find("#ui-dialog-buttonpane");self._setButtonState();var prev=options.buttonpane.find("#ui-lightbox-prev");prev.click(function(){self.prev();});self._makeHover(prev);var next=options.buttonpane.find("#ui-lightbox-next");next.click(function(){self.next();});self._makeHover(next);}options.wrapperElement.keydown(function(event){if(event.keyCode==$.ui.keyCode.ESCAPE){self.close();}});var closeElement=options.wrapperElement.find("#ui-lightbox-close");closeElement.click(function(){self.close();return false;});self._makeHover(closeElement);if((!event||!event.pageX||!event.pageY)&&options.pos=="offset"){options.pos="auto";}switch(options.pos){case"auto":var viewPos=self._pageScroll();var posLeft=viewPos[0]+(($(window).width()-options.wrapperElement.width())/2);var posTop=viewPos[1]+options.autoHeight;break;case"offset":var posLeft=event.pageX+options.offsetX;var posTop=event.pageY-options.offsetY;break;default:var position=options.pos.split(",");var posLeft=position[0];var posTop=position[1];break;}options.wrapperElement.css({left:posLeft+"px",top:posTop+"px",zIndex:options.zIndex}).fadeIn(options.animationSpeed).focus();self._changePicture(element,event);},_changePicture:function(element,event){var options=this.options,self=this;var contentWrapper=options.wrapperElement.find("#ui-lightbox-content");var imageWrapper=contentWrapper.find("#ui-lightbox-image");var imageElement=imageWrapper.find("img");imageElement.fadeOut(options.animationSpeed,function(){contentWrapper.attr("aria-live","assertive").attr("aria-relevant","additions removals text").attr("aria-busy",true);var image=new Image();image.onload=function(){imageElement.attr("src",element.attr("href")).attr("alt",options.altText.call(element));var calculatedX=(options.em)?image.width*options.em+"em":image.width;var calculatedY=(options.em)?image.height*options.em+"em":image.height;imageElement.css({width:calculatedX,height:calculatedY});switch(options.pos){case"offset":topPos=(event)?event.pageY:element.offset().top;leftPos=(event)?event.pageX:element.offset().left;options.wrapperElement.animate({left:leftPos+options.offsetX+"px",top:topPos+options.offsetY+"px",width:calculatedX},options.animationSpeed);break;case"auto":default:var viewPos=self._pageScroll();options.wrapperElement.animate({left:viewPos[0]+(($(window).width()-image.width)/2)+"px",width:calculatedX},options.animationSpeed);break;}imageWrapper.animate({height:calculatedY},options.animationSpeed,function(){imageElement.fadeIn(options.animationSpeed);options.wrapperElement.find("#ui-lightbox-description").html(options.descText.call(element));if(options.imageArray){options.wrapperElement.find("#ui-lightbox-pager").text(options.pictureText+" "+(options.activeImage+1)+" "+options.ofText+" "+options.imageArray.length);}options.wrapperElement.find("span#ui-dialog-title-dialog").html(options.titleText.call(element));if(options.useDimmer){self._dimmerResize();}self._updateVirtualBuffer();contentWrapper.attr("aria-busy",false);if($.address&&options.jqAddress.enable){if(options.jqAddress.title.enable){$.address.title($.address.title().split(options.jqAddress.title.split)[0]+options.jqAddress.title.split+options.altText.call(element));}$.address.value(element.attr("href"));}self._trigger("onChangePicture",0);});image.onload=function(){};};image.src=element.attr("href");});},_setButtonState:function(){var options=this.options;options.buttonpane.find("#ui-lightbox-next, #ui-lightbox-prev").removeAttr("disabled").removeClass("ui-state-disabled").removeClass("ui-state-focus");switch(options.activeImage){case 0:options.buttonpane.find("#ui-lightbox-prev").attr("disabled","disabled").removeClass("ui-state-hover").addClass("ui-state-disabled");options.buttonpane.find("#ui-lightbox-next").focus();break;case options.imageArray.length-1:options.buttonpane.find("#ui-lightbox-next").attr("disabled","disabled").removeClass("ui-state-hover").addClass("ui-state-disabled");options.buttonpane.find("#ui-lightbox-prev").focus();break;}},close:function(){var options=this.options,self=this;options.wrapperElement.fadeOut(options.animationSpeed,function(){$(this).remove();});if(options.useDimmer){$("#ui-lightbox-screendimmer").fadeOut(options.animationSpeed,function(){$(this).remove();});}$(options.clickedElement).focus();if($.address&&options.jqAddress.enable){if(options.jqAddress.title.enable){$.address.title($.address.title().split(options.jqAddress.title.split)[0]);}$.address.value("nogo");}self._trigger("onClose",0,options.activeImage);},prev:function(){var options=this.options,self=this;if(options.imageArray&&options.activeImage>0){options.activeImage=options.activeImage-1;self._changePicture($(options.imageArray[options.activeImage]));self._setButtonState();self._trigger("onPrev",0,options.activeImage);}},next:function(){var options=this.options,self=this;if(options.imageArray&&options.activeImage<(options.imageArray.length-1)){options.activeImage=options.activeImage+1;self._changePicture($(options.imageArray[options.activeImage]));self._setButtonState();self._trigger("onNext",0,options.activeImage);}},_createDimmer:function(){var options=this.options,self=this;var html='<div id="ui-lightbox-screendimmer" class="ui-widget-overlay" style="display: none;"></div>';$("body").append(html);$("#ui-lightbox-screendimmer").css({width:self._dimmerWidth()+"px",height:self._dimmerHeight()+"px",zIndex:options.zIndex}).fadeIn(options.animationSpeed).click(function(){self.close();});},_dimmerResize:function(){var self=this;var dimmer=$("#ui-lightbox-screendimmer");if(dimmer.length){dimmer.css({width:0,height:0});dimmer.css({width:self._dimmerWidth()+"px",height:self._dimmerHeight()+"px"});}},_dimmerHeight:function(){if($.browser.msie&&$.browser.version<7){var scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);var offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height();}else{return scrollHeight;}}else{return $(document).height();}},_dimmerWidth:function(){if($.browser.msie&&$.browser.version<7){var scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);var offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width();}else{return scrollWidth;}}else{return $(document).width();}},_pageScroll:function(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else{if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else{if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}}}arrayPageScroll=new Array(xScroll,yScroll);return arrayPageScroll;},_makeHover:function(element){element.bind("mouseenter",function(){$(this).addClass("ui-state-hover");}).bind("mouseleave",function(){$(this).removeClass("ui-state-hover");}).bind("focus",function(){$(this).addClass("ui-state-focus");}).bind("blur",function(){$(this).removeClass("ui-state-focus");});},_updateVirtualBuffer:function(){var form=$("body>form #virtualBufferForm");if(form.length){(form.val()=="1")?form.val("0"):form.val("1");}else{var html='<form><input id="virtualBufferForm" type="hidden" value="1" /></form>';$("body").append(html);}},destroy:function(){var options=this.options;if(options.makeHover){if(options.imageArray){options.imageArray.each(function(){$(this).unbind("mouseleave mouseenter focus blur");});}else{this.element.unbind("mouseleave mouseenter focus blur");}}this.element.unbind(".ariaLightbox").unbind("click").removeData("ariaLightbox");$("body>form #virtualBufferForm").parent().remove();$("body>div#ui-lightbox-screendimmer").remove();$("body>div#ui-lightbox-wrapper").unbind("keydown").remove();$.Widget.prototype.destroy.apply(this,arguments);}});})(jQuery);
